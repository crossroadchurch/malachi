<!DOCTYPE html>
<html>
    <head>
        <title>Malachi Server display test</title>
        <link rel="icon" href="/html/favicon.png" type="image/png" />
        <link rel="stylesheet" href="/html/singers.css" />
    </head>
    <body>
        <div id="text_area" style="background: #ff0000; width: 80vw; height:70vh; font-family:'Raleway'; font-size: 20vh;">
        </div>
        <script>
            let slide_index, item_index, current_slides;
            let text_area = document.querySelector("#text_area");
            let websocket = new WebSocket("ws://" + window.location.hostname + ":9001/basic");
            websocket.onmessage = function (event) {
                json_data = JSON.parse(event.data);
                console.log(json_data);
                switch(json_data.action){
                    case "update.basic-init":
                        item_index = json_data.params.item_index;
                        slide_index = json_data.params.slide_index;
                        current_slides = json_data.params.current_item.slides;
                        current_text = '';
                        current_segments = current_slides[slide_index].split(/\[[\w\+#\/"='' ]*\]/);
                        for (let segment=0; segment < current_segments.length; segment++){
                            cur_seg = current_segments[segment];
                            current_text = current_text + cur_seg;
                        }
                        text_area.innerHTML = current_text;
                        break;
                    case "update.slide-index-update":
                        slide_index = json_data.params.slide_index;
                        text_area.innerHTML = current_slides[slide_index];
                        current_text = '';
                        current_segments = current_slides[slide_index].split(/\[[\w\+#\/"='' ]*\]/);
                        for (let segment=0; segment < current_segments.length; segment++){
                            cur_seg = current_segments[segment];
                            current_text = current_text + cur_seg;
                        }
                        text_area.innerHTML = current_text;
                        break;
                    case "update.item-index-update":
                        break;
                    default:
                        console.error("Unsupported event", json_data);
                }
            }
        </script>
    </body>
</html>