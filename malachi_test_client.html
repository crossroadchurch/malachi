<!DOCTYPE html>
<html>
    <head>
        <title>Malachi Server functionality test</title>
    </head>
    <body>
        <button id="previous_item">Previous item</button>
        <button id="previous_slide">Previous slide</button>
        <button id="next_slide">Next slide</button>
        <button id="next_item">Next item</button>
        <p>Current item: <span id="item_i">-</span>, current slide: <span id="slide_i">-</span></p>
        <p>Current service plan:</p>
        <ul id="service_items"></ul>
        <button id="remove_item">Remove item at index</button><input id="remove_index"></index>
        <p>Move item from index <input id="move_from"></input> to index <input id="move_to"></input><button id="move_item">Move</button></p>
        <p>Current item:</p>
        <ul id="item_slides"></ul>
        <hr />
        <h3>Song methods</h3>
        <input id="song_id"></input><button id="add_song">Add song with this id</button>
        <input id="song_text_str"></input><button id="song_text_search">Search for text</button>
        <p>Search results:</p>
        <ul id="song_query_results"></ul>
        <hr />
        <h3>Presentation methods</h3>
        <button id="list_pres">List presentations</button>
        <input id="pres_url"></input><button id="add_pres">Add presentation with this (relative) url</button>
        <p>Presentation URLs</p>
        <ul id="pres_query_results"></ul>
        <hr />
        <h3>Add verse range</h3>
        <input id="from_verse"></input><input id="to_verse"></input><button id="add_bible_range">Add verse id range</button>
        <hr />
        <h3>Verse search</h3>
        <input id="bible_text_str"></input><button id="bible_text_search">Search for text</button>
        <input id="bible_ref_str"></input><button id="bible_ref_search">Search for ref</button>
        <p>Search results: <span id="query_status"></span></p>
        <ul id="verse_query_results"></ul>
        <script>
            let next_s = document.querySelector("#next_slide");
            let next_i = document.querySelector("#next_item");
            let prev_s = document.querySelector("#previous_slide");
            let prev_i = document.querySelector("#previous_item");
            let slide_idx = document.querySelector("#slide_i");
            let item_idx = document.querySelector("#item_i");
            let service_ul = document.querySelector("#service_items");
            let remove_i = document.querySelector("#remove_index");
            let remove_item = document.querySelector("#remove_item");
            let move_f = document.querySelector("#move_from");
            let move_t = document.querySelector("#move_to");
            let move_item = document.querySelector("#move_item");
            let slides_ul = document.querySelector("#item_slides");
            let song_id = document.querySelector("#song_id");
            let add_song = document.querySelector("#add_song");
            let song_t_str = document.querySelector("#song_text_str");
            let song_t_s = document.querySelector("#song_text_search");
            let s_results_ul = document.querySelector("#song_query_results");
            let list_pres = document.querySelector("#list_pres");
            let pres_url = document.querySelector("#pres_url");
            let add_pres = document.querySelector("#add_pres");
            let pres_ul = document.querySelector("#pres_query_results");
            let bible_t_s = document.querySelector("#bible_text_search");
            let bible_t_str = document.querySelector("#bible_text_str");
            let bible_r_s = document.querySelector("#bible_ref_search");
            let bible_r_str = document.querySelector("#bible_ref_str");
            let v_results_ul = document.querySelector("#verse_query_results");
            let query_s = document.querySelector("#query_status");
            let from_v = document.querySelector("#from_verse");
            let to_v = document.querySelector("#to_verse");
            let add_bible = document.querySelector("#add_bible_range");
            let websocket = new WebSocket("ws://127.0.0.1:9001/app");
            websocket.onmessage = function (event) {
                json_data = JSON.parse(event.data);
                console.log(json_data);
                switch(json_data.action){
                    case "update.styled-service-overview-update":
                        service_ul.innerHTML = "";
                        for(let item in json_data.params.items){
                            let li = document.createElement("li");
                            li.appendChild(document.createTextNode(json_data.params.items[item]));
                            service_ul.appendChild(li);
                        }
                        item_idx.textContent = json_data.params.item_index;
                        slide_idx.textContent = json_data.params.slide_index;
                        break;
                    case "update.slide-index-update":
                        item_idx.textContent = json_data.params.item_index;
                        slide_idx.textContent = json_data.params.slide_index;
                        break;
                    case "update.item-index-update":
                        item_idx.textContent = json_data.params.item_index;
                        slide_idx.textContent = json_data.params.slide_index;
                        slides_ul.innerHTML = "";
                        for(let slide in json_data.params.current_item.slides){
                            let li = document.createElement("li");
                            li.appendChild(document.createTextNode(json_data.params.current_item.slides[slide]));
                            slides_ul.appendChild(li);
                        }
                        break;
                    case "result.bible-verses":
                        query_s.textContent = json_data.params.status;
                        v_results_ul.innerHTML = "";
                        for(let verse in json_data.params.verses){
                            let li = document.createElement("li");
                            li.appendChild(document.createTextNode(
                                json_data.params.verses[verse][0] + " - " +
                                json_data.params.verses[verse][4]));
                            v_results_ul.appendChild(li);
                        }
                        break;
                    case "result.song-titles":
                        s_results_ul.innerHTML = "";
                        for(let song in json_data.params.songs){
                            let li = document.createElement("li");
                            li.appendChild(document.createTextNode(
                                json_data.params.songs[song][0] + " - " +
                                json_data.params.songs[song][1]));
                            s_results_ul.appendChild(li);
                        }
                        break;
                    case "result.all-presentations":
                        pres_ul.innerHTML = "";
                        for (let url in json_data.params.urls){
                            let li = document.createElement("li");
                            li.appendChild(document.createTextNode(json_data.params.urls[url]));
                            pres_ul.appendChild(li);
                        }
                        break;
                    default:
                        console.error("Unsupported event", json_data);
                }
            }
            next_s.onclick = function(event){
                websocket.send(JSON.stringify({"action": "command.next-slide", "params": {}}));
            }
            next_i.onclick = function(event){
                websocket.send(JSON.stringify({"action": "command.next-item", "params": {}}));
            }
            prev_s.onclick = function(event){
                websocket.send(JSON.stringify({"action": "command.previous-slide", "params": {}}));
            }
            prev_i.onclick = function(event){
                websocket.send(JSON.stringify({"action": "command.previous-item", "params": {}}));
            }
            add_song.onclick = function(event){
                websocket.send(JSON.stringify({"action": "command.add-song-item", "params": {"song-id": song_id.value}}));
            }
            song_t_s.onclick = function(event){
                websocket.send(JSON.stringify({"action": "query.song-by-text", "params": {"search-text": song_t_str.value}}));
            }
            bible_t_s.onclick = function(event){
                websocket.send(JSON.stringify({"action": "query.bible-by-text", "params": {"version": "NIV", "search-text": bible_t_str.value}}));
            }
            bible_r_s.onclick = function(event){
                websocket.send(JSON.stringify({"action": "query.bible-by-ref", "params": {"version": "NIV", "search-ref": bible_r_str.value}}));
            }
            add_bible.onclick = function(event){
                websocket.send(JSON.stringify({"action": "command.add-bible-item", "params": {"version": "NIV", "start-verse": from_v.value, "end-verse": to_v.value}}));
            }
            remove_item.onclick = function(event){
                websocket.send(JSON.stringify({"action": "command.remove-item", "params": {"index": remove_i.value}}));
            }
            move_item.onclick = function(event){
                websocket.send(JSON.stringify({"action": "command.move-item", "params": {"from-index": move_f.value, "to-index": move_t.value}}));
            }
            list_pres.onclick = function(event){
                websocket.send(JSON.stringify({"action": "request.all-presentations", "params": {}}));
            }
            add_pres.onclick = function(event){
                websocket.send(JSON.stringify({"action": "command.add-presentation", "params": { "url": pres_url.value}}));
            }
        </script>
    </body>
</html>